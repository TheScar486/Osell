{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mantenimiento - OSell AI Support</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f1115;
            color: #e5e7eb;
            height: 100dvh; /* Altura dinámica para móviles */
        }
        
        .glass-card {
            background-color: #1f2937;
            border: 1px solid #374151;
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.7);
        }

        .pulse-red {
            animation: pulse-red 2s infinite;
        }
        
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        /* Indicador de escritura más pequeño */
        .typing-indicator span {
            display: inline-block;
            width: 4px;
            height: 4px;
            background-color: #9ca3af;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out both;
            margin: 0 2px;
        }
        
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* Scrollbar estilizado */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
    </style>
</head>
<body class="w-full flex items-center justify-center p-2 overflow-y-auto overflow-x-hidden">

    <!-- Fondo decorativo fijo -->
    <div class="fixed inset-0 z-0 opacity-40 pointer-events-none">
        <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-b from-gray-900 to-[#0f1115]"></div>
    </div>

    <!-- Contenedor Principal: Se adapta para llenar pantalla o centrarse -->
    <div class="relative z-10 w-full max-w-lg glass-card rounded-2xl md:rounded-3xl overflow-hidden flex flex-col shadow-2xl">
        
        <!-- Encabezado Compacto -->
        <div class="pt-5 px-5 text-center shrink-0">
            <h2 class="text-2xl font-bold tracking-tight text-white mb-1">OSell</h2>
            <!-- Badge más pequeño -->
            <div class="inline-flex items-center px-2 py-0.5 rounded-full bg-red-900/30 border border-red-800 text-red-400 text-[10px] font-semibold uppercase tracking-wide mb-2">
                <span class="w-1.5 h-1.5 rounded-full bg-red-500 mr-1.5 animate-pulse"></span>
                Inhabilitado
            </div>
        </div>

        <!-- Cuerpo Scrolleable si es necesario -->
        <div class="flex-1 overflow-y-auto px-5 pb-2">
            
            <!-- Icono y Mensaje Integrados -->
            <div class="flex flex-col items-center mb-4">
                <!-- Icono Reducido -->
                <div class="relative w-14 h-14 md:w-20 md:h-20 bg-gray-800 rounded-full flex items-center justify-center border border-gray-700 pulse-red mb-3 shrink-0">
                    <i class="fas fa-database text-xl md:text-3xl text-gray-400"></i>
                    <div class="absolute -bottom-1 -right-1 bg-gray-900 rounded-full p-0.5 border border-gray-700">
                        <i class="fas fa-times-circle text-lg text-red-500"></i>
                    </div>
                </div>

                <h1 class="text-base md:text-xl font-semibold text-white mb-2 text-center">Servicio no disponible</h1>
                <p class="text-gray-400 text-xs md:text-sm leading-relaxed text-justify">
                    El servidor MySQL tuvo una interrupción inesperada. Por seguridad, el acceso está suspendido temporalmente mientras aplicamos parches. Tus datos están seguros.
                </p>
            </div>

            <!-- ✨ Asistente AI Compacto ✨ -->
            <div class="mb-4 p-3 bg-gradient-to-br from-indigo-900/40 to-purple-900/40 border border-indigo-500/30 rounded-lg relative overflow-hidden shrink-0">
                <div class="flex items-center mb-2">
                    <i class="fas fa-robot text-indigo-400 text-sm mr-2"></i>
                    <h3 class="text-white font-semibold text-xs">Asistente AI ✨</h3>
                </div>

                <div class="space-y-2">
                    <textarea 
                        id="userQuery" 
                        rows="1" 
                        class="w-full bg-gray-900/80 border border-gray-700 text-gray-200 text-xs rounded-md p-2 focus:ring-1 focus:ring-indigo-500 outline-none resize-none placeholder-gray-600"
                        placeholder="Pregunta aquí (ej: '¿Mis datos están bien?')..."></textarea>
                    
                    <button 
                        onclick="askGemini()" 
                        id="askBtn"
                        class="w-full py-1.5 px-3 bg-indigo-600 hover:bg-indigo-500 text-white text-xs font-medium rounded-md flex items-center justify-center gap-2 shadow-lg">
                        <span>Consultar</span>
                        <i class="fas fa-paper-plane text-[10px]"></i>
                    </button>

                    <!-- Área de Respuesta -->
                    <div id="responseArea" class="hidden mt-2 bg-gray-900/95 rounded-md p-2 border border-gray-700/50">
                        <div id="loadingIndicator" class="hidden text-center py-1">
                            <div class="typing-indicator"><span></span><span></span><span></span></div>
                        </div>
                        <div id="aiContent" class="text-xs text-gray-300 leading-relaxed whitespace-pre-wrap hidden"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer / Botones Fijos abajo -->
        <div class="p-5 pt-3 bg-gray-800/50 border-t border-gray-700/50 shrink-0">
            <div class="grid grid-cols-2 gap-3">
                <a href="https://wa.me/50245064229" target="_blank" class="flex flex-col items-center justify-center py-2 px-2 bg-gray-700 hover:bg-gray-600 border border-gray-600 hover:border-green-500/50 text-white rounded-lg transition-all group">
                    <i class="fab fa-whatsapp text-lg text-green-400 mb-1 group-hover:scale-110 transition-transform"></i>
                    <span class="text-[10px] md:text-xs font-medium">WhatsApp</span>
                </a>
                <a href="mailto:soporte.osell@gmail.com" class="flex flex-col items-center justify-center py-2 px-2 bg-gray-700 hover:bg-gray-600 border border-gray-600 hover:border-blue-500/50 text-white rounded-lg transition-all group">
                    <i class="fas fa-envelope text-lg text-blue-400 mb-1 group-hover:scale-110 transition-transform"></i>
                    <span class="text-[10px] md:text-xs font-medium">Correo</span>
                </a>
            </div>
            
            <div class="mt-3 flex justify-between items-center text-[10px] text-gray-500">
                <span>ID: #DB-503</span>
                <span>&copy; <span id="year"></span> OSell</span>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('year').textContent = new Date().getFullYear();

        // ⚠️ COLOCA TU API KEY AQUÍ PARA PRODUCCIÓN ⚠️
        const apiKey = "AIzaSyAIAdLXmGMTL8-k9hWrQNvLbOGY6rzzZz0"; 

        async function askGemini() {
            const userQuery = document.getElementById('userQuery').value.trim();
            if (!userQuery) return;

            const askBtn = document.getElementById('askBtn');
            const responseArea = document.getElementById('responseArea');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const aiContent = document.getElementById('aiContent');

            // Preparar UI
            aiContent.innerHTML = '';
            aiContent.classList.add('hidden');
            responseArea.classList.remove('hidden');
            
            // Validación de API Key
            if (!apiKey || apiKey === "") {
                aiContent.classList.remove('hidden');
                aiContent.innerHTML = `<span class="text-yellow-400 font-bold"><i class="fas fa-exclamation-triangle"></i> Falta API Key</span>`;
                return;
            }

            askBtn.disabled = true;
            askBtn.classList.add('opacity-75');
            loadingIndicator.classList.remove('hidden');

            const systemPrompt = `
                Eres "OSell AI". Sistema caído por fallo MySQL (seguridad/parches).
                Responde MUY BREVE (máx 2 frases) a: "${userQuery}".
                Tranquiliza sobre datos seguros o da mensaje corto para soporte.
            `;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: userQuery }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] }
                    })
                });

                const data = await response.json();
                if (data.error) throw new Error(data.error.message);

                const aiResponse = data.candidates[0].content.parts[0].text;
                
                loadingIndicator.classList.add('hidden');
                aiContent.classList.remove('hidden');
                aiContent.textContent = aiResponse;

                // Scroll suave hacia la respuesta si es necesario
                responseArea.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            } catch (error) {
                console.error(error);
                loadingIndicator.classList.add('hidden');
                aiContent.classList.remove('hidden');
                aiContent.innerHTML = `<span class="text-red-400">Error de conexión.</span>`;
            } finally {
                askBtn.disabled = false;
                askBtn.classList.remove('opacity-75');
            }
        }
    </script>
</body>
</html>

<!--{% load static %}

{% block title %}{% endblock %}

{% block extra_head %}
<title>Login Osell</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="{% static 'account/css/login.css' %}">
{% endblock %}

{% block content %}
<div class="login-container">
    <h1 class="login-title">Bienvenido</h1>
    
    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="error-message" role="alert">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <form method="post" class="login-form" aria-label="Formulario de inicio de sesión">
        {% csrf_token %}
        
        <div class="form-group">
            <input type="text" id="username" name="username" class="form-input" 
                   placeholder=" " required aria-required="true">
            <label for="username" class="floating-label">Usuario</label>
        </div>
        
        <div class="form-group">
            <input type="password" id="password" name="password" class="form-input" 
                   placeholder=" " required aria-required="true">
            <label for="password" class="floating-label">Contraseña</label>
        </div>
        
        <div class="form-options">
            <div class="remember-me">
                <input type="checkbox" id="remember" name="remember">
                <label for="remember">Recordar sesión</label>
            </div>
            <div class="forgot-password">
                <a href="" aria-label="Recuperar contraseña">¿Olvidaste tu contraseña?</a>
            </div>
        </div>
        
        <button type="submit" class="login-button" aria-label="Iniciar sesión">
            Iniciar Sesión
        </button>
    </form>
    
    <div class="signup-prompt">
        <p>¿No tienes cuenta? <a href="{% url 'registro_empresa' %}">Regístrate aquí</a></p>
    </div>
</div>
{% endblock %} -->
